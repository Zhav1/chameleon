import {z}from'zod';import {Inter,Merriweather,JetBrains_Mono,Bangers,Patrick_Hand}from'next/font/google';import {createContext,useState,useEffect,useCallback,useContext,useRef}from'react';import {useQueryState}from'nuqs';import {jsx,jsxs,Fragment}from'react/jsx-runtime';var Be=Object.defineProperty,je=Object.defineProperties;var We=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable;var ue=(o,t,e)=>t in o?Be(o,t,{enumerable:true,configurable:true,writable:true,value:e}):o[t]=e,E=(o,t)=>{for(var e in t||(t={}))_e.call(t,e)&&ue(o,e,t[e]);if(de)for(var e of de(t))He.call(t,e)&&ue(o,e,t[e]);return o},T=(o,t)=>je(o,We(t));var qe=z.object({themeName:z.string().describe("A creative name for this theme, e.g. 'Cyberpunk'"),colors:z.object({primary:z.string().regex(/^#[0-9A-Fa-f]{6}$/,"Must be valid hex color"),background:z.string().regex(/^#[0-9A-Fa-f]{6}$/,"Must be valid hex color"),text:z.string().regex(/^#[0-9A-Fa-f]{6}$/,"Must be valid hex color"),accent:z.string().regex(/^#[0-9A-Fa-f]{6}$/,"Must be valid hex color")}),typography:z.object({fontFamily:z.enum(["sans","serif","mono","display","hand"]),baseSize:z.enum(["14px","16px","18px","24px"])}),layout:z.object({style:z.enum(["standard","dense","hero"]),borderRadius:z.string()}),voice:z.object({tone:z.enum(["neutral","technical","simplified","storytelling"]),emojiFrequency:z.enum(["none","low","high"])})}),Ue=["sans","serif","mono","display","hand"],Ye=["standard","dense","hero"],Ge=["neutral","technical","simplified","storytelling"];var me=Inter({subsets:["latin"],variable:"--font-sans",display:"swap"}),ge=Merriweather({weight:["400","700"],subsets:["latin"],variable:"--font-serif",display:"swap"}),fe=JetBrains_Mono({subsets:["latin"],variable:"--font-mono",display:"swap"}),be=Bangers({weight:"400",subsets:["latin"],variable:"--font-display",display:"swap"}),he=Patrick_Hand({weight:"400",subsets:["latin"],variable:"--font-hand",display:"swap"}),te={sans:me,serif:ge,mono:fe,display:be,hand:he},et=()=>`${me.variable} ${ge.variable} ${fe.variable} ${be.variable} ${he.variable}`;var A={themeName:"Academic",colors:{primary:"#1a1a2e",background:"#fafafa",text:"#1a1a2e",accent:"#4a90d9"},typography:{fontFamily:"sans",baseSize:"16px"},layout:{style:"standard",borderRadius:"0.5rem"},voice:{tone:"neutral",emojiFrequency:"none"}},F={academic:A,cyberpunk:{themeName:"Cyberpunk",colors:{primary:"#00ff41",background:"#0d0208",text:"#00ff41",accent:"#ff0080"},typography:{fontFamily:"mono",baseSize:"14px"},layout:{style:"dense",borderRadius:"0px"},voice:{tone:"technical",emojiFrequency:"none"}},kid:{themeName:"Fun Zone",colors:{primary:"#ff6b6b",background:"#fff9db",text:"#2d3436",accent:"#00b894"},typography:{fontFamily:"display",baseSize:"24px"},layout:{style:"hero",borderRadius:"1.5rem"},voice:{tone:"simplified",emojiFrequency:"high"}},cozy:{themeName:"Cozy Cabin",colors:{primary:"#8b4513",background:"#fdf5e6",text:"#3e2723",accent:"#d4a574"},typography:{fontFamily:"hand",baseSize:"18px"},layout:{style:"standard",borderRadius:"1rem"},voice:{tone:"storytelling",emojiFrequency:"low"}}};var ye=createContext(null);function xe({children:o,initialVibe:t=A}){let[e,i]=useQueryState("vibe"),[r,n]=useState(t),[a,l]=useState(false),[s,c]=useState(null);useEffect(()=>{e&&F[e]&&n(F[e]);},[e]),useEffect(()=>{typeof window!="undefined"&&localStorage.setItem("chameleon-vibe",JSON.stringify(r));},[r]),useEffect(()=>{if(!e&&typeof window!="undefined"){let p=localStorage.getItem("chameleon-vibe");if(p)try{n(JSON.parse(p));}catch(m){}}},[e]);let y=useCallback(async p=>{l(true),c(null);try{let m=await fetch("/api/vibe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({description:p})});if(!m.ok)throw new Error("Failed to generate vibe");let w=await m.json();n(w);let P=w.themeName.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");i(P);}catch(m){c(m instanceof Error?m.message:"Unknown error"),console.error("Vibe generation failed:",m);}finally{l(false);}},[i]),f=useCallback(p=>{let m=F[p];m&&(n(m),i(p));},[i]),d=useCallback(()=>{n(A),i(null),typeof window!="undefined"&&localStorage.removeItem("chameleon-vibe");},[i]);return jsx(ye.Provider,{value:{vibe:r,isLoading:a,error:s,setVibe:y,setVibeFromPreset:f,resetVibe:d},children:o})}function g(){let o=useContext(ye);if(!o)throw new Error("useChameleon must be used within a ChameleonRoot");return o}function ve({children:o,className:t=""}){var l;let{vibe:e,isLoading:i}=g(),r=te[e.typography.fontFamily],n=((l=r==null?void 0:r.style)==null?void 0:l.fontFamily)||"system-ui, sans-serif",a=`layout-${e.layout.style}`;return console.log("[MorphLayout] Vibe updated:",{themeName:e.themeName,backgroundColor:e.colors.background,fontFamily:e.typography.fontFamily,resolvedFont:n}),jsx("div",{className:`morph-container ${a} ${i?"morphing":""} ${t}`,style:{"--chameleon-bg":e.colors.background,"--chameleon-text":e.colors.text,"--chameleon-primary":e.colors.primary,"--chameleon-accent":e.colors.accent,"--chameleon-font":n,"--chameleon-base-size":e.typography.baseSize,"--chameleon-radius":e.layout.borderRadius,backgroundColor:e.colors.background,color:e.colors.text,fontFamily:n,fontSize:e.typography.baseSize,borderRadius:e.layout.borderRadius,minHeight:"100vh",transition:"all 300ms ease-in-out"},children:o})}function ke({children:o,className:t=""}){let{vibe:e}=g();return jsx("div",{className:`morph-card ${t}`,style:{backgroundColor:e.colors.background,borderColor:`${e.colors.text}20`,borderRadius:e.layout.borderRadius},children:o})}function W({children:o,onClick:t,disabled:e,variant:i="primary",className:r=""}){let{vibe:n,isLoading:a}=g(),l=i==="primary";return jsx("button",{onClick:t,disabled:e||a,className:`morph-button ${r}`,style:{backgroundColor:l?n.colors.primary:"transparent",color:l?n.colors.background:n.colors.primary,border:l?"none":`2px solid ${n.colors.primary}`,borderRadius:n.layout.borderRadius,opacity:e?.5:1,cursor:e?"not-allowed":"pointer"},children:a?"\u2728 Morphing...":o})}function Ce({originalText:o,sourceUrl:t,className:e="",autoRewrite:i=true}){let{vibe:r}=g(),[n,a]=useState(o),[l,s]=useState(false),[c,y]=useState(null),f=useCallback(async()=>{var d;if(r.voice.tone==="neutral"){a(o);return}s(true),y(null);try{let p=await fetch("/api/rewrite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:o,tone:r.voice.tone,emojiFrequency:r.voice.emojiFrequency,sourceUrl:t})});if(!p.ok)throw new Error("Failed to rewrite content");let m=(d=p.body)==null?void 0:d.getReader(),w=new TextDecoder,P="";if(m)for(;;){let{done:x,value:k}=await m.read();if(x)break;let N=w.decode(k,{stream:!0});P+=N,a(P);}else {let x=await p.json();a(x.text||o);}}catch(p){y(p instanceof Error?p.message:"Rewrite failed"),a(o);}finally{s(false);}},[o,r.voice.tone,r.voice.emojiFrequency,t]);return useEffect(()=>{i&&f();},[i,f]),useEffect(()=>{a(o);},[o]),jsxs("div",{className:`morph-text ${l?"morphing":""} ${e}`,children:[jsx("div",{className:"morph-text-content whitespace-pre-wrap",children:n}),l&&jsx("div",{className:"morph-text-indicator text-sm opacity-60 mt-2",children:"\u2728 Adapting content..."}),c&&jsxs("div",{className:"morph-text-error text-red-500 text-sm mt-2",children:["\u26A0\uFE0F ",c]}),!i&&r.voice.tone!=="neutral"&&jsxs("button",{onClick:f,disabled:l,className:"morph-text-button mt-2 text-sm underline opacity-70 hover:opacity-100",children:["\u{1F504} Rewrite for ",r.voice.tone," tone"]})]})}function Ee({children:o,level:t=2,className:e=""}){let{vibe:i}=g(),n=jsxs(Fragment,{children:[o,i.voice.emojiFrequency==="none"?"":i.voice.emojiFrequency==="high"?" \u2728":""]}),a=`morph-heading ${e}`;switch(t){case 1:return jsx("h1",{className:a,children:n});case 2:return jsx("h2",{className:a,children:n});case 3:return jsx("h3",{className:a,children:n});case 4:return jsx("h4",{className:a,children:n});case 5:return jsx("h5",{className:a,children:n});case 6:return jsx("h6",{className:a,children:n});default:return jsx("h2",{className:a,children:n})}}function Re({placeholder:o="Describe your vibe... (e.g., 'Make it look like a hacker movie')",className:t=""}){let{setVibe:e,isLoading:i,error:r}=g(),[n,a]=useState("");return jsxs("form",{onSubmit:async s=>{s.preventDefault(),n.trim()&&!i&&(await e(n.trim()),a(""));},className:`vibe-input-form ${t}`,children:[jsxs("div",{className:"flex gap-3 items-center",children:[jsx("input",{type:"text",value:n,onChange:s=>a(s.target.value),placeholder:o,disabled:i,className:`flex-1 px-4 py-3 rounded-lg border-2 border-current/20 bg-transparent \r
                     focus:outline-none focus:border-current/40 transition-colors\r
                     placeholder:opacity-50`,style:{borderRadius:"var(--chameleon-radius)"}}),jsx(W,{disabled:!n.trim()||i,children:i?"\u2728":"\u{1F3A8} Morph"})]}),r&&jsxs("p",{className:"text-red-500 text-sm mt-2",children:["\u26A0\uFE0F ",r]})]})}function we({className:o=""}){let{setVibeFromPreset:t,vibe:e}=g(),i=Object.entries(F).map(([r,n])=>({key:r,name:n.themeName,emoji:lt(r)}));return jsx("div",{className:`vibe-presets flex flex-wrap gap-2 ${o}`,children:i.map(({key:r,name:n,emoji:a})=>jsxs("button",{onClick:()=>t(r),className:`px-4 py-2 rounded-full border-2 transition-all hover:scale-105
                      ${e.themeName===n?"border-current bg-current/10 font-semibold":"border-current/30 hover:border-current/60"}`,children:[a," ",n]},r))})}function lt(o){switch(o){case "academic":return "\u{1F4DA}";case "cyberpunk":return "\u{1F916}";case "kid":return "\u{1F388}";case "cozy":return "\u{1F3E1}";default:return "\u2728"}}var ct=[{id:"simple",label:"Simple",icon:"\u{1F476}",description:"Easy to understand",vibeDescription:"Make this extremely simple and easy to understand, like explaining to a curious 8-year-old. Use short sentences, fun analogies, and emojis."},{id:"expert",label:"Expert",icon:"\u{1F393}",description:"Full technical details",vibeDescription:"Make this technical and expert-level. Use precise terminology, include implementation details, and assume the reader is a senior developer."},{id:"visual",label:"Visual",icon:"\u{1F3A8}",description:"More diagrams & visuals",vibeDescription:"Make this visual and scannable. Use bullet points, highlight key concepts, suggest diagrams, and use a modern vibrant aesthetic."}];function U({onSelect:o}){let{vibe:t,setVibe:e,isLoading:i}=g(),r=async l=>{await e(l.vibeDescription),o==null||o();},a=t.voice.tone==="simplified"?"simple":t.voice.tone==="technical"?"expert":t.layout.style==="hero"?"visual":null;return jsx("div",{className:"reading-mode-selector",style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"8px"},children:ct.map(l=>{let s=a===l.id;return jsxs("button",{onClick:()=>r(l),disabled:i,className:"reading-mode-btn",style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",padding:"12px 8px",border:s?`2px solid ${t.colors.primary}`:"2px solid rgba(128, 128, 128, 0.2)",borderRadius:"8px",background:s?`${t.colors.primary}15`:"transparent",cursor:i?"wait":"pointer",transition:"all 150ms ease",opacity:i?.5:1},onMouseEnter:c=>{!s&&!i&&(c.currentTarget.style.background="rgba(128, 128, 128, 0.05)",c.currentTarget.style.borderColor=t.colors.primary);},onMouseLeave:c=>{s||(c.currentTarget.style.background="transparent",c.currentTarget.style.borderColor="rgba(128, 128, 128, 0.2)");},children:[jsx("span",{style:{fontSize:"24px"},children:l.icon}),jsx("span",{style:{fontSize:"14px",fontWeight:600,color:"var(--chameleon-text, #1a1a2e)"},children:l.label}),jsx("span",{style:{fontSize:"11px",opacity:.6,textAlign:"center"},children:l.description})]},l.id)})})}var Te=["Explain like I'm a gamer...","Make it feel like a cozy cabin...","I'm a 5 year old who loves dinosaurs...","Think cyberpunk hacker vibes...","Make it professional for my boss..."];function Y({onSubmit:o}){let[t,e]=useState(""),[i]=useState(()=>Te[Math.floor(Math.random()*Te.length)]),{setVibe:r,isLoading:n,vibe:a}=g();return jsxs("form",{onSubmit:async s=>{s.preventDefault(),!(!t.trim()||n)&&(await r(t.trim()),e(""),o==null||o());},className:"custom-vibe-input",children:[jsxs("div",{style:{display:"flex",gap:"8px"},children:[jsx("input",{type:"text",value:t,onChange:s=>e(s.target.value),placeholder:i,disabled:n,style:{flex:1,padding:"10px 14px",fontSize:"14px",border:"2px solid rgba(128, 128, 128, 0.2)",borderRadius:"8px",background:"transparent",color:"var(--chameleon-text, #1a1a2e)",outline:"none",transition:"border-color 150ms ease"},onFocus:s=>{s.currentTarget.style.borderColor=a.colors.primary;},onBlur:s=>{s.currentTarget.style.borderColor="rgba(128, 128, 128, 0.2)";}}),jsxs("button",{type:"submit",disabled:!t.trim()||n,style:{padding:"10px 16px",fontSize:"14px",fontWeight:600,border:"none",borderRadius:"8px",background:a.colors.primary,color:a.colors.background,cursor:!t.trim()||n?"not-allowed":"pointer",opacity:!t.trim()||n?.5:1,transition:"all 150ms ease",display:"flex",alignItems:"center",gap:"4px"},children:[jsx("span",{children:"Apply"}),jsx("span",{children:"\u2728"})]})]}),jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",marginTop:"10px"},children:["\u{1F3AE} Gamer","\u{1F476} Kid","\u{1F4BC} Pro","\u{1F319} Cozy"].map(s=>jsx("button",{type:"button",onClick:()=>e(s.slice(2)),disabled:n,style:{padding:"4px 10px",fontSize:"12px",border:"1px solid rgba(128, 128, 128, 0.2)",borderRadius:"16px",background:"transparent",cursor:"pointer",opacity:n?.5:1,transition:"all 100ms ease"},onMouseEnter:c=>{c.currentTarget.style.background="rgba(128, 128, 128, 0.1)";},onMouseLeave:c=>{c.currentTarget.style.background="transparent";},children:s},s))})]})}var dt={style:[{message:"Analyzing visual requirements...",icon:"\u{1F3A8}"},{message:"Selecting color palette...",icon:"\u{1F308}"},{message:"Choosing typography...",icon:"\u270D\uFE0F"},{message:"Optimizing layout...",icon:"\u{1F4D0}"},{message:"Applying theme...",icon:"\u2728"}],content:[{message:"Understanding context...",icon:"\u{1F9E0}"},{message:"Analyzing tone requirements...",icon:"\u{1F3AF}"},{message:"Adapting vocabulary...",icon:"\u{1F4DD}"},{message:"Restructuring content...",icon:"\u{1F504}"},{message:"Finalizing text...",icon:"\u2705"}],both:[{message:"Analyzing your vibe...",icon:"\u{1F98E}"},{message:"Understanding your preferences...",icon:"\u{1F9E0}"},{message:"Generating color palette...",icon:"\u{1F3A8}"},{message:"Selecting typography...",icon:"\u270D\uFE0F"},{message:"Adapting content style...",icon:"\u{1F4DD}"},{message:"Optimizing layout...",icon:"\u{1F4D0}"},{message:"Morphing complete!",icon:"\u2728"}]};function D({isThinking:o,steps:t,vibeType:e="both",messages:i,stepDelay:r=600,children:n,className:a=""}){let[l,s]=useState([]),[c,y]=useState(0),f=t||(i||dt[e]).map((d,p)=>({id:`step-${p}`,message:typeof d=="string"?d:d.message,icon:typeof d=="string"?"\u{1F504}":d.icon||"\u{1F504}",status:"thinking"}));return useEffect(()=>{if(!o){s([]),y(0);return}if(c>=f.length)return;let d=setTimeout(()=>{s(p=>{let m=[...p];return m.length>0&&(m[m.length-1]=T(E({},m[m.length-1]),{status:"complete"})),[...m,f[c]]}),y(p=>p+1);},c===0?100:r);return ()=>clearTimeout(d)},[o,c,r,f]),!o&&!l.length?jsx(Fragment,{children:n}):jsxs("div",{className:`thinking-bubble ${a}`,children:[jsxs("div",{style:{background:"rgba(128, 128, 128, 0.05)",borderRadius:"12px",padding:"16px",marginBottom:"16px"},children:[jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[jsx("span",{className:"thinking-pulse",style:{fontSize:"20px"},children:"\u{1F9E0}"}),jsx("span",{style:{fontWeight:600,fontSize:"14px"},children:"Chameleon is thinking..."})]}),jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:l.map((d,p)=>jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",paddingLeft:"8px",animation:"thinkingStepFadeIn 300ms ease-out"},children:[jsx("span",{style:{fontSize:"16px"},children:d.status==="complete"?"\u2705":d.icon}),jsx("span",{style:{fontSize:"14px",opacity:d.status==="complete"?.7:1,textDecoration:d.status==="complete"?"line-through":"none"},children:d.message}),d.status==="thinking"&&p===l.length-1&&jsxs("span",{className:"thinking-dots",children:[jsx("span",{className:"dot",children:"."}),jsx("span",{className:"dot",children:"."}),jsx("span",{className:"dot",children:"."})]})]},d.id))})]}),!o&&n&&jsx("div",{style:{animation:"thinkingContentFadeIn 500ms ease-out"},children:n}),jsx("style",{jsx:true,global:true,children:`
                @keyframes thinkingStepFadeIn {
                    from {
                        opacity: 0;
                        transform: translateX(-10px);
                    }
                    to {
                        opacity: 1;
                        transform: translateX(0);
                    }
                }

                @keyframes thinkingContentFadeIn {
                    from {
                        opacity: 0;
                        transform: translateY(10px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }

                .thinking-pulse {
                    animation: pulse 1.5s infinite;
                }

                @keyframes pulse {
                    0%, 100% { opacity: 1; }
                    50% { opacity: 0.5; }
                }

                .thinking-dots {
                    display: inline-flex;
                    margin-left: 4px;
                }

                .thinking-dots .dot {
                    animation: dotBlink 1.4s infinite;
                    opacity: 0;
                }

                .thinking-dots .dot:nth-child(1) {
                    animation-delay: 0s;
                }

                .thinking-dots .dot:nth-child(2) {
                    animation-delay: 0.2s;
                }

                .thinking-dots .dot:nth-child(3) {
                    animation-delay: 0.4s;
                }

                @keyframes dotBlink {
                    0%, 20%, 100% { opacity: 0; }
                    40%, 80% { opacity: 1; }
                }
            `})]})}function Pe(o=3e3){let[t,e]=useState(false),i=()=>{e(true);},r=()=>{e(false);};return useEffect(()=>{if(t){let n=setTimeout(()=>e(false),o);return ()=>clearTimeout(n)}},[t,o]),{isThinking:t,startThinking:i,stopThinking:r}}function G({isOpen:o,onClose:t,anchorRef:e}){let i=useRef(null),{vibe:r,isLoading:n}=g();return useEffect(()=>{let a=l=>{i.current&&!i.current.contains(l.target)&&e.current&&!e.current.contains(l.target)&&t();};return o&&document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[o,t,e]),o?jsxs("div",{ref:i,className:"vibe-popover",role:"dialog","aria-label":"Choose your reading mode",style:{position:"absolute",top:"calc(100% + 8px)",right:0,width:"340px",background:"var(--chameleon-bg, #ffffff)",border:"1px solid rgba(128, 128, 128, 0.2)",borderRadius:"12px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.15)",padding:"16px",zIndex:1e3,animation:"popoverSlideIn 200ms ease-out"},children:[n?jsx(D,{isThinking:true,vibeType:"both",stepDelay:500}):jsxs(Fragment,{children:[jsxs("div",{style:{marginBottom:"16px",textAlign:"center"},children:[jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:600,color:"var(--chameleon-text, #1a1a2e)"},children:"\u2728 How do you want to read this?"}),r.themeName!=="Academic"&&jsxs("p",{style:{margin:"4px 0 0",fontSize:"12px",opacity:.6},children:["Current: ",r.themeName]})]}),jsx(U,{onSelect:t}),jsxs("div",{style:{display:"flex",alignItems:"center",margin:"16px 0",gap:"12px"},children:[jsx("div",{style:{flex:1,height:"1px",background:"rgba(128, 128, 128, 0.2)"}}),jsx("span",{style:{fontSize:"12px",opacity:.5},children:"or"}),jsx("div",{style:{flex:1,height:"1px",background:"rgba(128, 128, 128, 0.2)"}})]}),jsx(Y,{onSubmit:t})]}),jsx("style",{jsx:true,global:true,children:`
                @keyframes popoverSlideIn {
                    from {
                        opacity: 0;
                        transform: translateY(-8px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
            `})]}):null}function Ve({position:o="navbar",className:t=""}){let[e,i]=useState(false),r=useRef(null),{vibe:n,isLoading:a}=g();return useEffect(()=>{let s=c=>{c.key==="Escape"&&e&&i(false);};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[e]),jsxs("div",{className:`chameleon-widget ${{navbar:"relative",floating:"fixed bottom-4 right-4 z-50",inline:"inline-block"}[o]} ${t}`,children:[jsx("button",{ref:r,onClick:()=>i(!e),className:"chameleon-trigger","aria-label":"Open Chameleon vibe selector","aria-expanded":e,"aria-haspopup":"dialog",style:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",borderRadius:"8px",border:"1px solid rgba(128, 128, 128, 0.2)",background:e?"rgba(128, 128, 128, 0.1)":"transparent",cursor:"pointer",transition:"all 150ms ease",fontSize:"20px"},onMouseEnter:s=>{s.currentTarget.style.background="rgba(128, 128, 128, 0.1)";},onMouseLeave:s=>{e||(s.currentTarget.style.background="transparent");},children:jsx("span",{className:a?"animate-pulse":"",children:"\u{1F98E}"})}),n.themeName!=="Academic"&&jsx("span",{className:"chameleon-badge",style:{position:"absolute",top:"-4px",right:"-4px",width:"12px",height:"12px",borderRadius:"50%",background:n.colors.primary,border:"2px solid var(--chameleon-bg, white)"},title:`Current vibe: ${n.themeName}`}),jsx(G,{isOpen:e,onClose:()=>i(false),anchorRef:r})]})}function K({type:o="text",width:t,height:e,lines:i=3,className:r="",style:n={},animate:a=true,children:l,isLoading:s=true}){if(!s&&l)return jsx(Fragment,{children:l});let c=E({background:"linear-gradient(90deg, rgba(128, 128, 128, 0.1) 25%, rgba(128, 128, 128, 0.2) 50%, rgba(128, 128, 128, 0.1) 75%)",backgroundSize:"200% 100%",animation:a?"skeletonShimmer 1.5s infinite":"none",borderRadius:"4px"},n);return jsxs(Fragment,{children:[(()=>{switch(o){case "heading":return jsx("div",{className:`skeleton-heading ${r}`,style:T(E({},c),{width:t||"70%",height:e||"32px"})});case "paragraph":return jsx("div",{className:`skeleton-paragraph ${r}`,style:{display:"flex",flexDirection:"column",gap:"8px"},children:Array.from({length:i}).map((f,d)=>jsx("div",{style:T(E({},c),{width:d===i-1?"60%":"100%",height:e||"16px"})},d))});case "card":return jsx("div",{className:`skeleton-card ${r}`,style:T(E({},c),{width:t||"100%",height:e||"200px",borderRadius:"12px"})});case "button":return jsx("div",{className:`skeleton-button ${r}`,style:T(E({},c),{width:t||"120px",height:e||"40px",borderRadius:"8px"})});case "image":return jsx("div",{className:`skeleton-image ${r}`,style:T(E({},c),{width:t||"100%",height:e||"160px",borderRadius:"8px"})});default:return jsx("span",{className:`skeleton-text ${r}`,style:T(E({},c),{display:"inline-block",width:t||"100px",height:e||"16px"})})}})(),jsx("style",{jsx:true,global:true,children:`
                @keyframes skeletonShimmer {
                    0% { background-position: 200% 0; }
                    100% { background-position: -200% 0; }
                }
            `})]})}function Le({isLoading:o,children:t,fallback:e}){return o?jsx("div",{className:"skeleton-morph-content",style:{position:"relative",opacity:.6,pointerEvents:"none"},children:e||jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[jsx(K,{type:"heading"}),jsx(K,{type:"paragraph",lines:4})]})}):jsx(Fragment,{children:t})}function De({onCapture:o,onClose:t,className:e=""}){let[i,r]=useState(false),[n,a]=useState(false),[l,s]=useState(null),[c,y]=useState(null),f=useRef(null),{setVibe:d}=g(),p=useCallback(async u=>{if(!u.type.startsWith("image/")){y("Please upload an image file");return}let b=new FileReader;b.onload=v=>{var z;let I=(z=v.target)==null?void 0:z.result;s(I);},b.readAsDataURL(u),a(true),y(null);try{let v=await new Promise((Ae,$e)=>{let j=new FileReader;j.onload=()=>{let Oe=j.result.split(",")[1];Ae(Oe);},j.onerror=$e,j.readAsDataURL(u);}),I=await fetch("/api/chameleon/analyze-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:v,mimeType:u.type})});if(!I.ok)throw new Error("Failed to analyze image");let z=await I.json();z.vibe&&(await d(`Clone the style of this design: ${z.description||"modern clean interface"}`),o==null||o(v),t==null||t());}catch(v){console.error("Screenshot analysis failed:",v),y("Failed to analyze screenshot. Please try again.");}finally{a(false);}},[d,o,t]),m=u=>{u.preventDefault(),u.stopPropagation(),r(true);},w=u=>{u.preventDefault(),u.stopPropagation(),r(false);},P=u=>{u.preventDefault(),u.stopPropagation();},x=u=>{u.preventDefault(),u.stopPropagation(),r(false);let b=u.dataTransfer.files;b.length>0&&p(b[0]);},k=u=>{let b=u.target.files;b&&b.length>0&&p(b[0]);},N=useCallback(u=>{let b=u.clipboardData.items;for(let v=0;v<b.length;v++)if(b[v].type.startsWith("image/")){let I=b[v].getAsFile();if(I){p(I);break}}},[p]);return n?jsxs("div",{className:`vibe-capture ${e}`,children:[jsx(D,{isThinking:true,vibeType:"style",stepDelay:700}),l&&jsx("div",{style:{marginTop:"12px",borderRadius:"8px",overflow:"hidden",opacity:.6},children:jsx("img",{src:l,alt:"Analyzing...",style:{width:"100%",height:"auto",maxHeight:"150px",objectFit:"cover"}})})]}):jsxs("div",{className:`vibe-capture ${e}`,onPaste:N,tabIndex:0,children:[jsxs("div",{onClick:()=>{var u;return (u=f.current)==null?void 0:u.click()},onDragEnter:m,onDragLeave:w,onDragOver:P,onDrop:x,style:{border:`2px dashed ${i?"var(--chameleon-primary, #4a90d9)":"rgba(128, 128, 128, 0.3)"}`,borderRadius:"12px",padding:"24px",textAlign:"center",cursor:"pointer",background:i?"rgba(74, 144, 217, 0.05)":"transparent",transition:"all 150ms ease"},children:[jsx("div",{style:{fontSize:"32px",marginBottom:"8px"},children:"\u{1F4F8}"}),jsx("p",{style:{margin:0,fontSize:"14px",fontWeight:500,color:"var(--chameleon-text, #1a1a2e)"},children:"Drop screenshot here"}),jsx("p",{style:{margin:"4px 0 0",fontSize:"12px",opacity:.6},children:"or click to upload \u2022 Cmd+V to paste"})]}),jsx("input",{ref:f,type:"file",accept:"image/*",onChange:k,style:{display:"none"}}),c&&jsx("p",{style:{margin:"8px 0 0",fontSize:"12px",color:"#ef4444",textAlign:"center"},children:c}),l&&!n&&jsxs("div",{style:{marginTop:"12px",borderRadius:"8px",overflow:"hidden",position:"relative"},children:[jsx("img",{src:l,alt:"Last captured",style:{width:"100%",height:"auto",maxHeight:"100px",objectFit:"cover"}}),jsx("button",{onClick:()=>s(null),style:{position:"absolute",top:"4px",right:"4px",width:"24px",height:"24px",borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.5)",color:"white",cursor:"pointer",fontSize:"12px"},children:"\xD7"})]})]})}function ze({onResult:o,onClose:t,className:e=""}){let[i,r]=useState(false),[n,a]=useState(""),[l,s]=useState(null),[c,y]=useState(true),f=useRef(null),{setVibe:d,isLoading:p}=g(),m=x=>{switch(x){case "not-allowed":return "Microphone access denied. Please allow microphone access.";case "no-speech":return "No speech detected. Please try again.";case "network":return "Network error. Please check your connection.";default:return "Voice recognition failed. Please try again."}},w=useCallback(async x=>{if(x.trim())try{await d(x.trim()),o==null||o(x.trim()),t==null||t();}catch(k){console.error("Failed to set vibe from voice:",k),s("Failed to apply vibe. Please try again.");}},[d,o,t]);useEffect(()=>{let x=window.SpeechRecognition||window.webkitSpeechRecognition;if(!x){y(false);return}let k=new x;return k.continuous=false,k.interimResults=true,k.lang="en-US",k.onresult=N=>{let u=N.resultIndex,b=N.results[u],v=b[0].transcript;a(v),b.isFinal&&w(v);},k.onerror=N=>{console.error("Speech recognition error:",N.error),s(m(N.error)),r(false);},k.onend=()=>{r(false);},f.current=k,()=>{f.current&&f.current.abort();}},[w,m]);let P=()=>{f.current&&(i?(f.current.stop(),r(false)):(a(""),s(null),f.current.start(),r(true)));};return c?jsxs("div",{className:`voice-vibe ${e}`,children:[jsxs("button",{onClick:P,disabled:p,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%",padding:"12px",border:`2px solid ${i?"#ef4444":"rgba(128, 128, 128, 0.2)"}`,borderRadius:"8px",background:i?"rgba(239, 68, 68, 0.1)":"transparent",cursor:p?"wait":"pointer",transition:"all 150ms ease",opacity:p?.5:1},children:[jsx("span",{style:{fontSize:"20px",animation:i?"voicePulse 1s infinite":"none"},children:i?"\u{1F534}":"\u{1F3A4}"}),jsx("span",{style:{fontSize:"14px",fontWeight:500,color:"var(--chameleon-text, #1a1a2e)"},children:i?"Listening...":"Speak your vibe"})]}),n&&jsxs("div",{style:{marginTop:"8px",padding:"8px 12px",borderRadius:"8px",background:"rgba(128, 128, 128, 0.05)",fontSize:"14px",fontStyle:"italic",animation:"fadeIn 200ms ease-out"},children:["\u201C",n,"\u201D"]}),l&&jsx("p",{style:{margin:"8px 0 0",fontSize:"12px",color:"#ef4444",textAlign:"center"},children:l}),jsx("div",{style:{marginTop:"10px",fontSize:"11px",opacity:.5,textAlign:"center"},children:"Try: \u201CMake it cozy\u201D or \u201CI'm a 5 year old\u201D"}),jsx("style",{jsx:true,global:true,children:`
                @keyframes voicePulse {
                    0%, 100% { transform: scale(1); opacity: 1; }
                    50% { transform: scale(1.2); opacity: 0.8; }
                }

                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(-4px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `})]}):jsx("div",{className:`voice-vibe ${e}`,children:jsxs("div",{style:{padding:"12px",borderRadius:"8px",background:"rgba(128, 128, 128, 0.1)",textAlign:"center"},children:[jsx("span",{style:{fontSize:"24px",opacity:.5},children:"\u{1F3A4}"}),jsx("p",{style:{margin:"8px 0 0",fontSize:"12px",opacity:.6},children:"Voice input not supported in this browser"})]})})}export{Ue as ALLOWED_FONTS,Ye as ALLOWED_LAYOUTS,Ge as ALLOWED_TONES,xe as ChameleonRoot,Ve as ChameleonWidget,Y as CustomVibeInput,A as DEFAULT_VIBE,W as MorphButton,ke as MorphCard,Ee as MorphHeading,ve as MorphLayout,Ce as MorphText,F as PRESET_VIBES,U as ReadingModeSelector,K as SkeletonMorph,Le as SkeletonMorphContent,D as ThinkingBubble,De as VibeCapture,Re as VibeInput,G as VibePopover,we as VibePresets,qe as VibeSchema,ze as VoiceVibe,te as fontMap,et as getAllFontVariables,g as useChameleon,Pe as useThinkingState};//# sourceMappingURL=index.mjs.map
//# sourceMappingURL=index.mjs.map